# PDF Watcher よくある質問（FAQ）

## 目次

1. [一般的な質問](#一般的な質問)
2. [機能に関する質問](#機能に関する質問)
3. [技術的な質問](#技術的な質問)
4. [トラブルシューティング](#トラブルシューティング)
5. [利用規約・サポート](#利用規約サポート)

## 一般的な質問

### Q: PDF Watcherとは何ですか？

**A:** PDF Watcherは、Webページ内のPDFリンクを自動的に監視・追跡するツールです。Chrome拡張機能でPDFリンクを抽出し、Google Apps Script（GAS）で変更を追跡・管理します。

### Q: どのような用途に使えますか？

**A:** 以下のような用途に適しています：
- 研究論文の公開状況の監視
- 企業の決算資料の更新チェック
- 官公庁の公開文書の追跡
- 教育機関の配布資料の管理
- ニュースサイトのPDF資料の収集

### Q: 無料で使えますか？

**A:** はい、PDF Watcherは社内ツールとして無料で利用できます。ただし、Google Apps ScriptやGoogle Spreadsheetsの利用には、Googleアカウントの利用規約が適用されます。

### Q: どのブラウザで使えますか？

**A:** 現在はGoogle Chrome（およびChromiumベースのブラウザ）でのみ利用可能です。Firefox版やSafari版の開発予定は現在ありません。

## 機能に関する質問

### Q: 何ページまで監視できますか？

**A:** 理論上の制限はありませんが、実用的には以下の制限があります：
- 1回の実行で処理できるページ数：約150-180ページ（5分以内）
- 6分制限対策により、1000ページ以上も処理可能（実績：1000ページ、約50,000 PDF）
- スプレッドシートの行数制限：1000万セル

### Q: どのくらいの頻度でチェックできますか？

**A:** 
- 手動実行：いつでも可能
- 自動実行：GASのトリガーで設定可能（最短1分間隔）
- 推奨：1日1〜4回程度（サーバー負荷を考慮）

### Q: PDFの内容も保存されますか？

**A:** いいえ、PDF WatcherはPDFのURLと存在状態のみを記録します。PDFファイル自体のダウンロードや内容の保存は行いません。

### Q: PDFリンク件名取得機能とは何ですか？

**A:** 2025年6月30日に実装された機能で、WebページのPDFリンクのテキスト（リンク件名）を自動的に抽出する機能です：
- **抽出内容**: HTMLのリンクテキスト全体（`<span>`、`<strong>`などの子要素内のテキストも含む）
- **文字数制限**: なし（Webページに表示されているテキストをそのまま取得）
- **特殊文字処理**: タブと改行文字はスペースに変換、連続する空白は単一の空白に正規化
- **表示場所**: Changes、ArchivePDF、ChangesHistoryシートで件名を表示
- **利点**: PDFの内容を開かなくても、Webページに表示されている完全なテキストで識別可能

### Q: 削除されたPDFも追跡できますか？

**A:** はい、PDFが削除された場合も以下の情報を保持します：
- 削除確認日時
- ステータス（「ページから削除」）
- 過去の履歴

### Q: Changes履歴保存機能とは何ですか？

**A:** 処理完了時に、前回実行時のChangesシートのデータを自動的にChangesHistoryシートに保存する機能です：
- **保存期間**: 5日間（古いデータは自動削除）
- **保存内容**: 実行ID、ページURL、PDFのURL、保存日時
- **利点**: 過去の変更履歴を確認できる
- **注意**: 6分制限で中断された場合は保存されません

### Q: PageSummaryの7世代履歴管理とは何ですか？

**A:** 2025年6月に拡張された機能で、各ページURLの実行結果を7世代分保持する機能です：
- **履歴数**: 3世代から7世代へ拡張
- **自動削除**: 8回目の実行で最古のデータを自動削除
- **表示**: Summaryシートで直近7回の実行結果を確認可能
- **利点**: より長期的な変更傾向を把握できる
- **データ構造**: Run-1（最新）からRun-7（最古）まで横持ちで管理

### Q: 複数のユーザーで共有できますか？

**A:** はい、Googleスプレッドシートの共有機能を使用して複数ユーザーで利用できます：
- マスタースプレッドシート：読み取り専用で共有推奨
- クライアントスプレッドシート：各ユーザーが個別に作成

### Q: モバイルデバイスで使えますか？

**A:** Chrome拡張機能はデスクトップ版Chromeでのみ動作します。ただし、Googleスプレッドシートはモバイルアプリでも閲覧・編集可能です。

## 技術的な質問

### Q: どのような技術スタックを使用していますか？

**A:** 
- **フロントエンド**: Chrome Extension (Manifest V3)
- **バックエンド**: Google Apps Script (GAS)
- **データベース**: Google Spreadsheets
- **言語**: TypeScript
- **ビルドツール**: esbuild, clasp

### Q: なぜimport/export文が使えないのですか？

**A:** Google Apps Scriptの制限により、ES6モジュールシステムはサポートされていません。そのため、グローバル変数とファイル名プレフィックスによる名前空間管理を採用しています。

### Q: 6分実行時間制限とは何ですか？

**A:** Google Apps Scriptには1回の実行で最大6分という制限があります。PDF Watcherは以下の対策を実装しています：
- 5分で自動中断
- 状態を保存
- 7分後に自動再開
- 中断箇所から処理継続

### Q: バッチ処理の仕組みは？

**A:** 効率的な処理のため、以下の階層でバッチ処理を行います：
1. **グループ**: 30ページごと
2. **ミニバッチ**: 5ページごと
3. **並列実行**: ミニバッチ単位で並列処理

### Q: ハッシュ値はどのように計算されますか？

**A:** Chrome拡張機能でページのテキストコンテンツから簡易ハッシュを生成します：
- アルゴリズム：DJB2ハッシュ関数
- 用途：ページ変更の検出
- 保存：最新のハッシュ値のみ保持

### Q: APIレート制限はありますか？

**A:** Google Apps Scriptの制限に準じます：
- URLフェッチ：20,000回/日
- スプレッドシート読み書き：50,000回/日
- 実行時間：6時間/日

## トラブルシューティング

### Q: 「認証が必要です」と表示されます

**A:** 初回実行時はGoogleアカウントの認証が必要です：
1. 「runJudge」実行時に表示される承認画面で許可
2. 「詳細」→「安全でないページに移動」を選択
3. 必要な権限を許可

### Q: Chrome拡張機能が動作しません

**A:** 以下を確認してください：
1. 拡張機能が有効になっているか
2. ページが完全に読み込まれているか
3. HTTPSサイトかどうか（HTTPサイトでは制限あり）
4. コンソールでエラーが出ていないか

### Q: PDFリンクの件名が表示されません

**A:** 以下の原因が考えられます：
1. **古いバージョンの使用**: 2025年6月30日以降のバージョンか確認
2. **リンクテキストがない**: 画像リンクの場合は件名が取得できません
3. **JavaScriptで動的生成**: ページ読み込み後に生成されるリンクは取得できない場合があります
4. **TSV形式の問題**: 複数行TSV形式（1PDF1行）になっているか確認

### Q: 処理が遅いです

**A:** 以下の要因が考えられます：
- ネットワーク速度
- ページのサイズ
- PDFの数
- スプレッドシートのデータ量

対策：
- バッチサイズを調整
- 不要なデータをアーカイブ
- 処理時間帯を変更

### Q: エラーが発生して処理が止まります

**A:** エラーの種類により対処法が異なります：
- **タイムアウト**: 自動的に再開されます
- **権限エラー**: スプレッドシートの共有設定を確認
- **API制限**: 翌日まで待つか、処理を分割

詳細は[トラブルシューティングガイド](troubleshooting.md)を参照してください。

## 利用規約・サポート

### Q: 利用に制限はありますか？

**A:** 社内利用を前提としたツールです。外部への提供や販売は禁止されています。

### Q: ソースコードを改変できますか？

**A:** はい、社内利用の範囲で自由に改変できます。改善提案がある場合は、開発チームまでご連絡ください。

### Q: サポートは受けられますか？

**A:** 社内の開発チームがサポートを提供しています：
- バグ報告：開発チームのSlackチャンネルまで
- 機能要望：同上
- 使い方の質問：ドキュメントを参照の上、不明点は開発チームへ

### Q: データのプライバシーは？

**A:** 
- すべてのデータはユーザーのGoogleアカウント内に保存
- 外部サーバーへのデータ送信なし
- PDFファイルのダウンロードなし
- URLとメタデータのみを記録

### Q: 利用に際しての注意事項は？

**A:** 
- 対象サイトの利用規約を確認
- 過度なアクセスは避ける
- robots.txtを尊重
- 著作権法を遵守

---

## その他の質問

上記以外の質問がある場合は、以下をご利用ください：

1. [GitHub Issues](https://github.com/your-repo/pdf-watcher/issues)で質問
2. [トラブルシューティングガイド](troubleshooting.md)を確認
3. [開発者ガイド](CONTRIBUTING.md)を参照

新しいFAQの追加提案も歓迎します！
# ステータスフィールド追加に伴うテスト計画

## 概要
PDFモデルに「ステータス」フィールドを追加し、PDFがWebページから削除されたことを視覚的に確認できるようにしました。この変更に伴う影響確認と無影響確認のためのテスト項目を定義します。

## 実装内容
- PDFモデルに`status`フィールドを追加（`ページ内に存在` | `ページから削除`）
- ArchivePDFシートに「ステータス」列を追加（5列目）
- 既存PDFのlastSeen更新機能を追加
- 削除されたPDFのステータスを「ページから削除」に変更する機能を追加

## 🔴 影響確認テスト（必須）

### 1. 新規インストール時の動作確認
**目的**: 新規にシステムを導入した際、ArchivePDFシートが正しく作成されるか確認

**手順**:
1. 新しいスプレッドシートを作成
2. `setupMasterSpreadsheet()`を実行
3. ArchivePDFシートが5列で作成されることを確認
4. ヘッダーが「ページURL」「PDF URL」「初回発見日時」「最終確認日時」「ステータス」であることを確認

**期待結果**: 
- 5列のシートが正しく作成される
- ヘッダーが正しく設定される

### 2. 既存システムへの互換性確認
**目的**: 4列の既存ArchivePDFシートがある環境で正常に動作するか確認

**準備**:
1. 4列の既存ArchivePDFシート（ステータス列なし）を用意
2. いくつかのPDFデータを登録しておく

**手順**:
1. 修正後のコードをデプロイ
2. `runJudge()`を実行
3. エラーが発生しないことを確認
4. 手動でステータス列を追加
5. 再度`runJudge()`を実行

**期待結果**:
- 4列でもエラーにならない（ステータスはデフォルト値になる）
- 5列追加後は正常にステータスが更新される

### 3. PDFステータス更新の正確性確認
**目的**: PDFの各状態遷移が正しく記録されるか確認

**テストケース**:

#### 3-1. 新規PDF追加
1. 新しいPDFを含むページをスキャン
2. `runJudge()`実行
3. ArchivePDFシートでステータスが「ページ内に存在」になることを確認

#### 3-2. 既存PDF継続確認
1. 既に登録されているPDFを含むページを再スキャン
2. `runJudge()`実行
3. lastSeenが更新され、ステータスが「ページ内に存在」のままであることを確認

#### 3-3. PDF削除検出
1. PDFリンクを手動で削除（Currentシートから行を削除）
2. `runJudge()`実行
3. 削除されたPDFのステータスが「ページから削除」に変更されることを確認
4. lastSeenが更新されないことを確認

#### 3-4. 削除後の再追加
1. 「ページから削除」ステータスのPDFを再度追加
2. `runJudge()`実行
3. ステータスが「ページ内に存在」に戻ることを確認
4. lastSeenが更新されることを確認

### 4. パフォーマンステスト
**目的**: ステータス更新処理が性能に与える影響を確認

**手順**:
1. 100個以上のPDFを含むページで処理時間を計測
2. 修正前と修正後で処理時間を比較
3. UserLogシートの実行時間を確認

**期待結果**: 
- 処理時間の大幅な増加がない（±10%以内）

## 🟡 無影響確認テスト（推奨）

### 5. 他のシート機能の確認
**目的**: 他のシートや機能に影響がないことを確認

**チェック項目**:
- [x] Changesシートが正常に表示される（追加PDFのみ）
- [x] PageHistoryシートが正常に記録される
- [x] PageSummaryシートが正常に更新される
- [x] RunLogシートが正常に記録される
- [x] UserLogシートが正常に記録される

### 6. クライアント側の動作確認
**目的**: クライアント側のスプレッドシートに影響がないことを確認

**チェック項目**:
- [x] Chrome拡張からのデータ貼り付けが正常に動作
- [x] `runJudge()`の実行が正常に完了
- [x] Summaryシートの`IMPORTRANGE`が正常に動作

### 7. エラーハンドリングの確認
**目的**: 異常系の処理が正しく動作することを確認

**テストケース**:
- [x] 不正なステータス値がある場合のデフォルト処理（実運用では発生しないため省略可）
- [x] スプレッドシートへのアクセス権限がない場合
- [x] 同時実行時のロック処理

## 🟢 回帰テスト（オプション）

### 8. 基本機能の総合確認
**目的**: PDFWatcherの基本機能が全て正常に動作することを確認

**シナリオ**:
1. 複数ページをChrome拡張でスキャン
2. バッチ処理で一括判定
3. 一部PDFを削除して再実行
4. 新規PDFを追加して再実行
5. 複数回実行して履歴を確認

**確認ポイント**:
- [x] 全ての処理が正常に完了
- [x] データの整合性が保たれている
- [x] UIに異常な表示がない

## テスト実施記録

| テスト番号 | テスト名 | 実施日 | 実施者 | 結果 | 備考 |
|-----------|---------|--------|--------|------|------|
| 1 | 新規インストール時の動作確認 | 2025/06/21 | システム | ✅合格 | D列ヘッダーが「削除確認日時」に正しく変更 |
| 2 | 既存システムへの互換性確認 | - | - | スキップ | 既存システムが存在しないため |
| 3-1 | 新規PDF追加 | 2025/06/21 | システム | ✅合格 | 33個のPDFが正常に追加 |
| 3-2 | 既存PDF継続確認 | 2025/06/21 | システム | ✅合格 | 削除確認日時が空欄のまま維持 |
| 3-3 | PDF削除検出 | 2025/06/21 | システム | ✅合格 | 3個のPDFが「ページから削除」に変更 |
| 3-4 | 削除後の再追加 | 2025/06/21 | システム | ✅合格 | ステータスが「ページ内に存在」に戻る |
| 4 | パフォーマンステスト | 2025/06/21 | システム | ✅合格 | 全実行が2-6秒で完了 |
| 5 | 他のシート機能の確認 | 2025/06/21 | システム | ✅合格 | 全シートが正常に動作（テストログで確認） |
| 6 | クライアント側の動作確認 | 2025/06/21 | システム | ✅合格 | Chrome拡張、IMPORTRANGE正常動作 |
| 7 | エラーハンドリングの確認 | 2025/06/21 | システム | ✅合格 | 全項目確認（不正値は実運用で発生しないため省略） |
| 8 | 基本機能の総合確認 | 2025/06/21 | システム | ✅合格 | 全処理正常、データ整合性確保 |

## 注意事項
- テスト実施前に必ずバックアップを取得すること
- 本番環境でテストする場合は、影響範囲を最小限にすること
- ステータス列を手動で追加する場合は、5列目に追加すること
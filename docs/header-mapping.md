# スプレッドシートヘッダーマッピング

**最終更新**: 2025-06-30

このドキュメントは、日本語版と英語版のヘッダー対応表です。
将来的な国際化対応時に使用してください。

## Master Spreadsheet (中央ブック)

### ArchivePDF シート
| 日本語 | 英語 | 説明 |
|--------|------|------|
| ページURL | PageURL | 監視対象のWebページURL |
| 件名 | Subject | PDFリンクの件名（2025-06-30追加） |
| PDF URL | PDFURL | PDFファイルのURL |
| 初回発見日時 | FirstSeen | PDFを最初に発見した日時 |
| 最終確認日時 | LastSeen | PDFを最後に確認した日時 |
| ステータス | Status | PDFの状態（「ページ内に存在」/「ページから削除」） |
| 削除確認日時 | DeleteConfirmed | PDFが削除されたことを確認した日時 |

### PageHistory シート
| 日本語 | 英語 | 説明 |
|--------|------|------|
| 実行日時 | RunDate | バッチ実行日時 |
| ページURL | PageURL | 監視対象のWebページURL |
| ページ更新 | PageUpd? | ページが更新されたか (TRUE/FALSE) |
| PDF更新 | PDFUpd? | PDFが更新されたか (TRUE/FALSE) |
| 追加数 | AddedCnt | 追加されたPDFの数 |
| ユーザー | User | 実行したユーザーのメールアドレス |

### PageSummary シート（7世代対応）
| 日本語 | 英語 | 説明 |
|--------|------|------|
| ページURL | PageURL | 監視対象のWebページURL |
| 最新ハッシュ | LastHash | ページの最新ハッシュ値 |
| 実行1-日時 | Run-1 Date | 直近1回目の実行日時 |
| 実行1-ページ | Run-1 PU | 直近1回目のページ更新有無 |
| 実行1-PDF | Run-1 PFU | 直近1回目のPDF更新有無 |
| 実行1-追加数 | Run-1 Cnt | 直近1回目の追加PDF数 |
| 実行2-日時 | Run-2 Date | 直近2回目の実行日時 |
| 実行2-ページ | Run-2 PU | 直近2回目のページ更新有無 |
| 実行2-PDF | Run-2 PFU | 直近2回目のPDF更新有無 |
| 実行2-追加数 | Run-2 Cnt | 直近2回目の追加PDF数 |
| 実行3-日時 | Run-3 Date | 直近3回目の実行日時 |
| 実行3-ページ | Run-3 PU | 直近3回目のページ更新有無 |
| 実行3-PDF | Run-3 PFU | 直近3回目のPDF更新有無 |
| 実行3-追加数 | Run-3 Cnt | 直近3回目の追加PDF数 |
| 実行4-日時 | Run-4 Date | 直近4回目の実行日時 |
| 実行4-ページ | Run-4 PU | 直近4回目のページ更新有無 |
| 実行4-PDF | Run-4 PFU | 直近4回目のPDF更新有無 |
| 実行4-追加数 | Run-4 Cnt | 直近4回目の追加PDF数 |
| 実行5-日時 | Run-5 Date | 直近5回目の実行日時 |
| 実行5-ページ | Run-5 PU | 直近5回目のページ更新有無 |
| 実行5-PDF | Run-5 PFU | 直近5回目のPDF更新有無 |
| 実行5-追加数 | Run-5 Cnt | 直近5回目の追加PDF数 |
| 実行6-日時 | Run-6 Date | 直近6回目の実行日時 |
| 実行6-ページ | Run-6 PU | 直近6回目のページ更新有無 |
| 実行6-PDF | Run-6 PFU | 直近6回目のPDF更新有無 |
| 実行6-追加数 | Run-6 Cnt | 直近6回目の追加PDF数 |
| 実行7-日時 | Run-7 Date | 直近7回目の実行日時 |
| 実行7-ページ | Run-7 PU | 直近7回目のページ更新有無 |
| 実行7-PDF | Run-7 PFU | 直近7回目のPDF更新有無 |
| 実行7-追加数 | Run-7 Cnt | 直近7回目の追加PDF数 |

### RunLog シート
| 日本語 | 英語 | 説明 |
|--------|------|------|
| 実行ID | ExecID | 一意の実行識別子 |
| タイムスタンプ | Timestamp | 実行開始時刻 |
| ユーザー | User | 実行したユーザー |
| 実行時間(秒) | Dur s | 処理にかかった時間（秒） |
| 処理ページ数 | PagesProc | 処理したページ数 |
| 更新ページ数 | PagesUpd | 更新があったページ数 |
| 追加PDF数 | PDFsAdd | 追加されたPDF数 |
| 結果 | Result | SUCCESS/ERROR |
| エラーメッセージ | ErrorMsg | エラーの詳細（エラー時のみ） |
| スクリプトVer | ScriptVer | 実行時のスクリプトバージョン |

## Client Spreadsheet (クライアントブック)

### Current シート
ヘッダーなし（Chrome拡張からのTSVデータを貼り付ける）

### Changes シート
| 日本語 | 英語 | 説明 |
|--------|------|------|
| ページURL | PageURL | 変更があったページのURL |
| 件名 | Subject | PDFリンクの件名（2025-06-30追加） |
| PDFのURL | PDFURL | 新規追加されたPDFのURL（1行1URL） |

### Summary シート
中央ブックのPageSummaryシートをIMPORTRANGEで参照（ヘッダーも含めて同じ）

### UserLog シート
| 日本語 | 英語 | 説明 |
|--------|------|------|
| タイムスタンプ | Timestamp | 実行開始時刻 |
| 実行時間(秒) | Duration s | 処理にかかった時間（秒） |
| 処理ページ数 | PagesProc | 処理したページ数 |
| 更新ページ数 | PagesUpd | 更新があったページ数 |
| 追加PDF数 | PDFsAdd | 追加されたPDF数 |
| 結果 | Result | SUCCESS/ERROR |
| エラーメッセージ | ErrorMsg | エラーの詳細（エラー時のみ） |

### ChangesHistory シート
| 日本語 | 英語 | 説明 |
|--------|------|------|
| 保存日時 | SavedAt | 履歴が保存された日時 |
| 実行ID | RunID | 実行の一意識別子 |
| ページURL | PageURL | 変更があったページのURL |
| 件名 | Subject | PDFリンクの件名（2025-06-30追加） |
| PDFのURL | PDFURL | 新規追加されたPDFのURL |
| 削除予定日時 | ExpiresAt | この履歴が自動削除される日時 |

## 現在の実装状態

### ✅ 実装済みの新機能
1. **PDFステータスフィールド** (2025-06-21実装)
   - ArchivePDFシートに「ステータス」「削除確認日時」列を追加
   - PDFの存在状態を明示的に管理
   - 削除されたPDFの追跡が可能

2. **6分実行時間制限対策** (2025-06-22実装)
   - UserLogシートにミニバッチ単位での記録が追加
   - グループ分割処理による複数回実行の記録

3. **Changes履歴保存機能** (2025-06-26実装)
   - ChangesHistoryシートを追加
   - 5日間の変更履歴を自動保存
   - 古いデータの自動削除機能

4. **PDFリンク件名取得機能** (2025-06-30実装)
   - ArchivePDF、Changes、ChangesHistoryシートに「件名」列を追加
   - Chrome拡張機能でリンクテキストを自動抽出
   - PDFの内容を件名で識別可能

## 国際化対応時の注意事項

1. **列の順序は変更しない**
   - プログラムは列番号でアクセスしているため、順序変更は影響大

2. **データ型は維持する**
   - 日付、数値、真偽値の型は言語に関わらず同じ

3. **IMPORTRANGEの考慮**
   - Summaryシートは中央ブックの言語設定に従う

4. **スクリプト側の対応**
   - ヘッダー文字列を定数化して言語切り替え可能にする
   - 例: `const HEADERS = LANG === 'ja' ? HEADERS_JA : HEADERS_EN`

5. **新機能追加時の配慮**
   - 新しい列は既存のデータの末尾に追加
   - 互換性を保つため、既存の列順を変更しない
# 6分制限対策の動作仕様

## 再実行時の動作について

PDFWatcherの6分制限対策では、処理が中断された場合に自動的に再実行されます。
この際、以下の動作が発生します：

### 1. 初回実行時
- 新規ページとして処理
- PageHistoryに「TRUE TRUE 件数」として記録
- RunLog/UserLogに処理件数が記録

### 2. タイムアウト後の再実行時
- 既に処理済みのページは「変更なし」として扱われる
- PageHistoryに「FALSE FALSE 0」として記録
- RunLog/UserLogの更新件数は0になる

### なぜこのような動作になるのか

1. **データの整合性を保つため**
   - 同じページを複数回「新規」として扱うと、統計情報が不正確になります
   - 例：実際は100ページなのに、再実行により200ページとカウントされる問題を防ぎます

2. **重複登録を防ぐため**
   - 同じPDFが複数回登録されることを防ぎます
   - マスターデータベースの一貫性を保ちます

3. **冪等性を保証するため**
   - 同じ処理を何度実行しても、同じ結果になることを保証します
   - これにより、安全に再実行できます

### 実運用での考え方

- **初回実行**：その日の新規データとして処理
- **再実行**：処理の継続・確認として扱われる
- **統計情報**：初回実行時のみカウントされる

これは設計上の正しい動作であり、データの信頼性を確保するための仕様です。
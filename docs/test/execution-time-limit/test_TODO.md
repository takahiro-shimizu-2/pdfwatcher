# GAS 6分実行時間制限対策 テストTODOリスト

## 概要
このTODOリストは、6分制限対策機能のテストを実施するためのタスクリストです。
テスト仕様書（test-specification.md）に基づいて、各テストを順次実施します。

## 前提条件
- 開発実装が完了していること
- テスト用スプレッドシートが準備されていること
- テストデータの生成方法が確立されていること

## Phase 1: テスト環境準備

### Task 1: テスト環境のセットアップ
- [ ] テスト用スプレッドシートを新規作成
- [ ] 必要なシート（Current, Changes, UserLog等）を作成
- [ ] テスト用のGoogle Apps Scriptプロジェクトを作成
- [ ] 開発版コードをテスト環境にデプロイ

### Task 2: テストデータ生成スクリプトの作成
- [ ] 指定数のダミーページURLを生成する関数を作成
- [ ] 各ページに複数のPDF URLを含める機能を追加
- [ ] Currentシートへのテストデータ投入関数を作成
- [ ] データクリア関数を作成

### Task 3: テストユーティリティの作成
- [ ] 処理時間を測定する関数を作成
- [ ] PropertiesServiceの内容を確認する関数を作成
- [ ] トリガーの状態を確認する関数を作成
- [ ] テスト結果を記録するシートを準備

## Phase 2: 基本機能テスト

### Task 4: 小規模データ処理テスト（TC-001）
- [ ] 20ページのテストデータを準備
- [ ] runJudge()を実行
- [ ] 処理が1回で完了することを確認
- [ ] トリガーが設定されないことを確認
- [ ] 全ページが処理されたことを確認

### Task 5: 中規模データ処理テスト（TC-002）
- [ ] 60ページのテストデータを準備
- [ ] runJudge()を実行
- [ ] 1回目の処理（30ページ）完了を確認
- [ ] トリガーによる2回目の自動実行を確認
- [ ] 全60ページの処理完了を確認

### Task 6: 大規模データ処理テスト（TC-003）
- [ ] 120ページのテストデータを準備
- [ ] runJudge()を実行
- [ ] 4回の分割処理を確認
- [ ] 各回のトリガー設定・削除を確認
- [ ] 全120ページの処理完了を確認

## Phase 3: 時間制限テスト

### Task 7: 5分経過時の自動中断テスト（TC-004）
- [ ] 処理遅延シミュレーション機能を実装
- [ ] 50ページのテストデータを準備
- [ ] runJudge()を実行し、5分経過を待つ
- [ ] 処理が適切に中断されることを確認
- [ ] 処理状態が「paused」で保存されることを確認

### Task 8: 6分制限シミュレーションテスト（TC-005）
- [ ] 実際の処理時間に近い環境を構築
- [ ] 40ページのテストデータを準備
- [ ] 処理の進行を監視
- [ ] 適切なタイミングで中断・再開されることを確認

## Phase 4: 状態管理テスト

### Task 9: 処理状態の保存・復元テスト（TC-006）
- [ ] 60ページのテストデータを準備
- [ ] 1回目の処理後、PropertiesServiceを確認
- [ ] 保存された状態の内容を検証
- [ ] 2回目の処理で状態が正しく復元されることを確認

### Task 10: 古い処理状態の無視テスト（TC-007）
- [ ] 25時間前のタイムスタンプを持つ状態を設定
- [ ] runJudge()を実行
- [ ] 古い状態が無視されることを確認
- [ ] 新規処理として開始されることを確認

## Phase 5: トリガー管理テスト

### Task 11: トリガー設定・削除テスト（TC-008）
- [ ] 既存トリガーの状態を記録
- [ ] 60ページの処理を実行
- [ ] トリガーが適切に設定されることを確認
- [ ] 処理完了後、トリガーが削除されることを確認

### Task 12: 異常終了時のトリガー残存テスト（TC-009）
- [ ] エラーを発生させる仕組みを準備
- [ ] エラー発生状況で処理を実行
- [ ] エラー後もトリガーが残ることを確認
- [ ] 次回実行でリトライされることを確認

## Phase 6: UI機能テスト

### Task 13: カスタムメニューテスト（TC-010）
- [ ] スプレッドシートを開く
- [ ] 「PDFWatcher」メニューの表示を確認
- [ ] 各メニュー項目（処理開始、状況確認、中止、ヘルプ）を実行
- [ ] 各機能が正常に動作することを確認

### Task 14: 処理状況表示テスト（TC-011）
- [ ] 処理実行中に「処理状況確認」を実行
- [ ] 進捗情報が正しく表示されることを確認
- [ ] 次回実行予定時刻が表示されることを確認
- [ ] UIの使いやすさを評価

### Task 15: 処理キャンセルテスト（TC-012）
- [ ] 処理実行中に「処理を中止」を実行
- [ ] 確認ダイアログの動作を確認
- [ ] キャンセル後、トリガーが削除されることを確認
- [ ] 処理状態がクリアされることを確認

## Phase 7: エラー処理テスト

### Task 16: ネットワークエラーテスト（TC-013）
- [ ] ネットワークエラーのシミュレーション方法を確立
- [ ] エラー発生時の動作を確認
- [ ] エラーが適切に記録されることを確認
- [ ] 次回実行でリトライされることを確認

### Task 17: 連続エラー時の停止テスト（TC-014）
- [ ] 連続エラーを発生させる仕組みを準備
- [ ] 3回のリトライを確認
- [ ] 3回目のエラー後、処理が停止することを確認
- [ ] ステータスが「cancelled」になることを確認

## Phase 8: 境界値テスト

### Task 18: エッジケーステスト（TC-015～017）
- [ ] 0ページの処理テスト
- [ ] 1ページの処理テスト
- [ ] ちょうど30ページの処理テスト
- [ ] 各ケースで適切に動作することを確認

### Task 19: 同時実行防止テスト（TC-018）
- [ ] 2つのブラウザタブで同時実行を試みる
- [ ] 2つ目の実行がブロックされることを確認
- [ ] 適切なエラーメッセージが表示されることを確認

## Phase 9: パフォーマンステスト

### Task 20: 処理時間測定（PT-001）
- [ ] 10ページの処理時間を測定
- [ ] 30ページの処理時間を測定
- [ ] 50ページの処理時間を測定（参考）
- [ ] 30ページが5分以内に完了することを確認

### Task 21: メモリ使用量確認（PT-002）
- [ ] 大量データ処理時のメモリ使用を監視
- [ ] メモリリークがないことを確認
- [ ] GASの制限内で動作することを確認

## Phase 10: 回帰テスト

### Task 22: 既存機能への影響確認（RT-001）
- [ ] 通常のrunJudge()実行が正常に動作
- [ ] バッチ処理機能が正常に動作
- [ ] シート更新が正確に行われる
- [ ] 既存のエラーハンドリングが機能する

## Phase 11: 統合テスト

### Task 23: エンドツーエンドテスト
- [ ] 実際の使用シナリオに基づくテスト
- [ ] 複数の機能を組み合わせたテスト
- [ ] 長時間実行テスト（複数回の自動継続）
- [ ] 異常系を含む総合的なテスト

### Task 24: ユーザビリティテスト
- [ ] 実際のユーザーによる操作テスト
- [ ] フィードバックの収集
- [ ] UIの改善点の洗い出し
- [ ] ドキュメントの分かりやすさ確認

## Phase 12: リリース準備

### Task 25: テスト結果のまとめ
- [ ] 全テスト結果を集計
- [ ] 問題点と対策をまとめる
- [ ] パフォーマンス測定結果をまとめる
- [ ] テストレポートを作成

### Task 26: 最終確認
- [ ] すべての必須テストが合格
- [ ] 既知の問題がドキュメント化されている
- [ ] ロールバック手順が準備されている
- [ ] リリース判定会議の実施

## 注意事項

1. **テスト実施時の注意**
   - 本番環境への影響を避ける
   - テストデータは必ずクリアする
   - エラー時のスクリーンショットを保存

2. **問題発見時の対応**
   - 即座に開発チームに報告
   - 再現手順を明確に記録
   - 影響範囲を特定

3. **テストの優先順位**
   - Phase 1-4は必須
   - Phase 5-8は重要
   - Phase 9-12は推奨

## 完了条件

- [ ] すべての必須テストが実施されている
- [ ] 重大な問題が解決されている
- [ ] テストレポートが作成されている
- [ ] リリース判定が完了している